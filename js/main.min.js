(function(e){window.main={vars:{},init:function(){var t=main.vars.header=e("#header"),n=t.mainNavigation=e(".main-navigation",t);e(".share-popup-btn").on("click",function(){var t=e(this).attr("href"),n=640,r=305,i=(e(window).width()-n)/2,s=(e(window).height()-r)/2;window.open(t,"sharer","toolbar=0,status=0,width="+n+",height="+r+",left="+i+", top="+s);return!1});e(".print-btn").on("click",function(e){e.preventDefault();window.print()});this.lightbox.init();this.ajaxPage.init();this.scroller.init();this.accordion.init();this.facebook.init();e(window).resize(this.resize);this.resize()},loaded:function(){e("body").addClass("loaded");this.equalHeight()},lightbox:{init:function(){var t=main.lightbox.container=e("#lightbox"),n=main.lightbox.overlay=e(".overlay",t),r=main.lightbox.content=e(".content",t),i=main.lightbox.loader=e(".loader",t);e(".lightbox-btn").on("click",main.lightbox.open);n.on("click",main.lightbox.close);e(document).on("click","#lightbox .close-btn",main.lightbox.close)},open:function(t){t.preventDefault();main.lightbox.load(e(this).attr("href"))},load:function(t){var n=main.lightbox.container,r=main.lightbox.overlay,i=main.lightbox.content,s=main.lightbox.loader,o=e(document).height(),u=e(window).height(),a=e(window).scrollTop(),f=main.addToUrl(t,"ajax"),f=main.addToUrl(f,"lightbox");n.height(o);n.show();s.fadeIn();i.hide();r.fadeIn("slow",function(){e.get(f,function(t){i.html(t);s.fadeOut(function(){if(e.fn.imagesLoaded)i.imagesLoaded(function(){var e=a+(u-i.height())/2;e+i.height()>o-60&&(e=o-i.height()-60);i.animate({top:e},function(){i.fadeIn()})});else{var t=a+(u-i.height())/2;t+i.height()>o-60&&(t=o-i.height()-60);n.animate({top:t},function(){i.fadeIn()})}})})})},close:function(){var e=main.lightbox.container,t=main.lightbox.overlay,n=main.lightbox.content;n.fadeOut(function(){t.fadeOut(function(){e.hide()});n.html()})}},accordion:{init:function(){e.fn.accordion&&e(".accordion").each(function(){var t=e(this),n=t.width(),r=t.children().size(),i=t.data("tab-width")?t.data("tab-width"):32;resizeChildren=t.data("resize-children")?t.data("resize-children"):!0,options={slideClass:"item",tabWidth:i,width:n,height:330,animationComplete:function(){var t=e(this);t.addClass(options.slideClass+"-opened")},animationStart:function(){var n=options.slideClass;t.addClass("opened");e("."+n,t).removeClass(n+"-opened")},close:function(){var n=options.slideClass;e("."+n,t).removeClass(n+"-opened")},closed:function(){t.removeClass("opened")}};t.accordion(options);e(window).on("load",function(){setTimeout(function(){e(".item.current",t).trigger("click")},1e3)})})}},scroller:{init:function(){e.fn.scroller&&e(".scroller").each(function(){var t=e(this),n={};if(t.hasClass("gallery-scroller")||t.data("scroll-all")===!0)n.scrollAll=!0;t.data("auto-scroll")===!0&&(n.autoScroll=!0);t.data("resize")===!0&&(n.resize=!0);t.data("callback")&&t.bind("onChange",function(n,r){var i=window[t.data("callback")];i(e(this),r)});t.scroller(n)})}},facebook:{init:function(){e.ajaxSetup({cache:!0});e.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:"579639135402354",channelUrl:"//lrfb.occam-dm.com/channel.php",status:!0,xfbml:!0,oauth:!0,frictionlessRequests:!0});main.facebook.ready()})},ready:function(){e(".send-to-friends-btn").on("click",function(){FB.ui({method:"send",link:"http://www.landrover.co.uk/"})});e(".share-btn").on("click",function(){var t=e(this).data("url"),n=e(this).data("name"),r=e(this).data("image"),i=e(this).data("caption"),s=e(this).data("description");FB.ui({method:"feed",link:t,name:n,description:s,picture:r,caption:i},function(e){})});FB.Canvas.setAutoGrow();main.competition.init();main.notification.init();main.youtube.init()},checkPermissions:function(e,t){FB.api("/me/permissions",function(n){var r=n.data[0],i=!1;for(var s in e){var o=e[s];r[o]&&(i=!0)}t(i)})}},competition:{init:function(){var t=main.competition.form=e(".competition"),n=main.competition.email={field:e("#field_1_3",t),input:e("#input_1_3",t)},r=main.competition.name={field:e("#field_1_6",t),input:{firstName:e("#input_1_6_3",t),lastName:e("#input_1_6_6",t)}},i=main.competition.facebook={input:e("#input_1_4",t)},s=main.competition.accessToken={input:e("#input_1_5",t)},o=main.competition.permissions=["email"];if(t.length>0){FB.getLoginStatus(function(e){if(e.status==="connected")main.facebook.checkPermissions(o,function(t){t&&FB.api("/me",function(t){n.input.val(t.email);r.input.firstName.val(t.first_name);r.input.lastName.val(t.last_name);s.input.val(e.authResponse.accessToken)})});else if(t.parent().hasClass("gform_validation_error")){n.field.show();r.field.show()}});t.on("submit",main.competition.submit)}},submit:function(){var e=main.competition.form,t=main.competition.email,n=main.competition.name,r=main.competition.facebook,i=main.competition.accessToken,s=main.competition.permission;if(t.input.val())return!0;FB.getLoginStatus(function(o){o.status==="connected"?main.facebook.checkPermissions(s,function(s){s?FB.api("/me",function(s){t.input.val(s.email);n.input.firstName.val(s.first_name);n.input.lastName.val(s.last_name);r.input.val("1");i.input.val(o.authResponse.accessToken);e.submit()}):main.competition.authorize()}):o.status==="not_authorized"?main.competition.login():main.competition.login()});return!1},login:function(){form=main.competition.form,email=main.competition.email,name=main.competition.name;FB.login(function(e){if(e.status==="connected")form.submit();else{alert("If you would not like to login with Facebook, please enter your email address");email.field.show();name.field.show()}},{scope:main.competition.permissions.join(",")})},authorize:function(){FB.ui({method:"oauth",scope:main.competition.permissions.join(",")},function(e){e&&main.competition.form.submit()})}},notification:{init:function(){var t=main.notification.form=e(".notification"),n=main.notification.email={input:e("#input_2_1",t)},r=main.notification.accessToken={input:e("#input_2_2",t)},i=main.notification.userId={input:e("#input_2_3",t)},s=main.notification.permissions=["email"];if(t.length>0){FB.getLoginStatus(function(e){e.status==="connected"&&main.facebook.checkPermissions(s,function(t){t&&FB.api("/me",function(t){n.input.val(t.email);r.input.val(e.authResponse.accessToken);i.input.val(t.id)})})});t.on("submit",main.notification.submit)}},submit:function(){var e=main.notification.form,t=main.notification.email,n=main.notification.accessToken,r=main.notification.userId,i=main.notification.permissions;if(t.input.val())return!0;FB.getLoginStatus(function(s){s.status==="connected"?main.facebook.checkPermissions(i,function(i){i?FB.api("/me",function(i){t.input.val(i.email);n.input.val(s.authResponse.accessToken);r.input.val(i.id);e.submit()}):main.notification.authorize()}):s.status==="not_authorized"?main.notification.login():main.notification.login()});return!1},login:function(){FB.login(function(e){e.status==="connected"&&main.notification.form.submit()},{scope:main.notification.permissions.join(",")})},authorize:function(){FB.ui({method:"oauth",scope:main.notification.permissions.join(",")},function(e){e&&main.notification.form.submit()})}},youtube:{init:function(){var t=main.youtube.video=e("#youtube-video"),n=main.youtube.overlay=t.parent().find(".overlay");player=main.youtube.player={},main.youtube.authorized=!1;t.length>0&&e.getScript("//www.youtube.com/player_api",function(){FB.getLoginStatus(function(e){e.status==="connected"&&main.facebook.checkPermissions(main.notification.permissions,function(e){main.youtube.authorized=e})});main.youtube.player=new YT.Player("youtube-video",{videoId:t.data("video-id"),events:{onReady:main.youtube.onPlayerReady,onStateChange:main.youtube.onPlayerStateChange}})})},onPlayerReady:function(e){main.youtube.player.playVideo()},onPlayerStateChange:function(e){e.data===0&&!main.youtube.authorized&&main.youtube.overlay.fadeIn()}},ajaxPage:{init:function(){var t=main.ajaxPage.container=e("#ajax-page"),n=main.ajaxPage.pageUrl=window.location.href;e(".ajax-btn").on("click",function(t){main.ajaxPage.load(e(this).attr("href"));return!1});e(document).on("click","#ajax-page .close-btn",function(){main.ajaxPage.close()})},load:function(t){var n=main.ajaxPage.container,r=main.addToUrl(t,"ajax");if(e(".content",n).length==0){n.show();s=e('<div class="loader"></div>');s.hide();n.html(s);n.animate({height:s.actual("outerHeight")},function(){s.fadeIn();e.get(r,function(t){var r=e('<div class="content"></div>');r.hide();n.append(r);r.html(t);s.fadeOut(function(){e.fn.imagesLoaded?r.imagesLoaded(function(){n.animate({height:r.height()},function(){n.css({height:"auto"});r.fadeIn();n.slideDown("slow");main.facebook.setCanvasHeight()})}):n.animate({height:r.actual("height")},function(){n.css({height:"auto"});r.fadeIn();main.facebook.setCanvasHeight()})})})})}else{var i=e(".content",n),s=e('<div class="loader"></div>').hide();n.prepend(s);i.fadeTo(300,0,function(){s.fadeIn();e.get(r,function(e){i.html(e);s.fadeOut(function(){n.animate({height:i.actual("height")},function(){i.fadeTo(300,1);n.css({height:"auto"});main.facebook.setCanvasHeight()})})})})}},close:function(){var e=main.ajaxPage.container;e.slideUp(function(){e.html("")})}},addToUrl:function(e,t){var n=new RegExp("(\\?|\\&)"+t+"=.*?(?=(&|$))"),r=/\?.+$/;n.test(e)?e=e.replace(n,"$1"+t+"=true"):r.test(e)?e=e+"&"+t+"=true":e=e+"?"+t+"=true";return e},equalHeight:function(){if(e(".equal-height").length!==0){var t=0,n=0,r=new Array,s=0;e(".equal-height").each(function(){var o=e(this);s=o.position().top;if(n!=s){for(i=0;i<r.length;i++)r[i].height(t);r.length=0;n=s;t=o.height();r.push(o)}else{r.push(o);t=t<o.height()?o.height():t}for(i=0;i<r.length;i++)r[i].height(t)})}},resize:function(){var t=e(window).width(),n=main.vars.header.mainNavigation;t<=600&&n.is(":visible")?n.hide():t>600&&!n.is(":visible")&&n.show()},tabs:{init:function(){var t=main.tabs.container=e(".tabs"),n=main.tabs.content=e(".tab-content",t),r=main.tabs.navigationItems=e(".tab-navigation li",t);e("a",r).on("click",function(){main.tabs.goto(e(this).data("id"))})},"goto":function(t){var n=main.tabs.navigationItems,r=main.tabs.content;n.removeClass("current");e("a[data-id="+t+"]").parent().addClass("current");e(".tab",r).hide();e(".tab[data-id="+t+"]",r).fadeIn()}}};e(function(){main.init()});e(window).load(function(){main.loaded()})})(jQuery);